<div class="users-container">
 

  <div class="search-section">
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        placeholder="Search users by name, email, or phone..."
        class="search-input"
      />
      <span class="search-icon">üîç</span>
    </div>
  </div>

  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>

  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    Loading users...
  </div>

  <div class="table-container" *ngIf="!loading">
    <table class="users-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Date of Birth</th>
          <th>Last Login</th>
          <th>Created At</th>
          <th>Modified At</th>
          <th>Role</th>
          <th>Actions</th>
          
        </tr>
      </thead>
     <tbody>
          <tr *ngFor="let user of filteredUsers; trackBy: trackByUserId" class="user-row">
            <!-- colonnes utilisateur... -->
          <td>{{ user.firstName }} {{ user.lastName }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.phoneNumber || 'N/A' }}</td>
          <td>{{ formatDate(user.dateOfBirth) }}</td>
          <td>{{ formatDateTime(user.lastLogin) }}</td>
          <td>{{ formatDateTime(user.createdAt) }}</td>
          <td>{{ formatDateTime(user.modifiedAt) }}</td>
          <td>{{ getRoleName(user) }}</td>

            <td class="actions">
              <!-- Bouton ouvrir modal + d√©finir selectedUser -->
              <button type="button" class="btn btn-primary" 
                      data-bs-toggle="modal" 
                      data-bs-target="#exampleModal"
                      (click)="selectedUserForRole = user">
                ‚úèÔ∏è
              </button>

              <button class="btn btn-danger btn-sm" (click)="deleteUser(user)" title="Delete User">
                üóëÔ∏è
              </button>
            </td>
          </tr>
        </tbody>

        <!-- Modal (hors de la boucle) -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">

              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Set Role for {{ selectedUserForRole?.firstName }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body" *ngIf="selectedUserForRole">
                <select [(ngModel)]="selectedUserForRole.selectedRoleId" class="form-select">
                    <option value="" disabled selected>Select a role</option>
                  <option *ngFor="let role of roles" [value]="role.id">{{ role.nom }}</option>
                </select>
              </div>

              <div class="modal-footer" *ngIf="selectedUserForRole">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button (click)="assignRoleToUser(selectedUserForRole.id, selectedUserForRole.selectedRoleId); closeModal()" class="btn btn-primary">
                  Assigner le r√¥le
                </button>
              </div>

            </div>
          </div>
        </div>

       

    </table>

    <div class="no-results" *ngIf="filteredUsers.length === 0 && !loading">
      <p>No users found matching your search criteria.</p>
    </div>
  </div>

  <div class="results-count" *ngIf="!loading">
    Showing {{ filteredUsers.length }} of {{ users.length }} users
  </div>

  <div class="pagination-controls">
  <button (click)="previousPage()" [disabled]="currentPage === 0">Previous</button>

  <button
    *ngFor="let page of pageNumbers"
    [class.active]="page === currentPage"
    (click)="goToPage(page)">
    {{ page + 1 }}
  </button>

  <button (click)="nextPage()" [disabled]="currentPage === totalPages - 1">Next</button>
</div>
</div>